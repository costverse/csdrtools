---
title: "CSDR Submission Import And Review Checklist"
output: 
  html_document: 
    toc: yes
    toc_float: yes
    fig_width: 10
    number_sections: yes
    df_print: default
    toc_depth: 6
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
.main-container {
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# options(width = 115)

# options(tibble.print_max = Inf)

source(here::here("R", "00_setup_csdr_submission_review.R"))
```

# Introduction & Overview

```{r}
# TODO: Add the checklist from the pptx file into here and/or an intro to talk about what this is.
```

1. Utilize cPet to confirm there are no critical errors.  
1. Merge submission files into a tidy format.  
1. Confirm quantities and reported CSDR price match the contract.  
1. Confirm lowest level WBS elements units, hours, and costs are consistent with dictionary.  
   * Are WBS with 0 units/hours/dollars reported and the dictionary says there is no SOW?
   * Are there WBS with > 0 units/hours/dollars reported where the dictionary says there is SOW?
1. Confirm average unit costs and hours by WBS element appear reasonable.
1. Confirm units, hours, and dollars To Date vs. At Competition appears reasonable.  
   * Are reported PctDollars or PctHours complete reasonable compared to program schedule, units DD-250â€™ed, etc.?  
   * Are PctDollars significantly different than PctHours complete?  
1. Confirm units/hours/dollars Nonrecurring vs. Recurring appears reasonable.
   * Are material costs primarily recurring?  
   * Is engineering labor primarily non-recurring?  
1. Confirm labor rates by Functional Element appear reasonable.  
   * Are the averages reasonable?  
   * For common Functional Elements, are variances by WBS Element, Recurring vs. Nonrecurring, To Date vs. At Completion reasonable?  
1. Confirm the overhead rate appear reasonable.
   * Are they consistent from WBS element to element?  
   * Is there value reasonable and/or check that it is close to their Forward Rate Pricing Agreement/Proposal values.
1. Confirm recurring unit cost by WSB Element appear reasonable.  
   * Are the averages reasonable?  
   * Are averages To Date reasonably compared to EAC/FAC.  
1. Do dictionary entries include the DID required info?  
1. Do WBS element and submission remarks include the required info?  
1. Are there any special requirements listed in the CSDR Plan that require checks?  
1. Are there any other data deliverables (e.g., a BOM) that need to be checked for consistency with the CSDR submission (or could provide additional explanation)?  

# CSDR Submission Review

## Dictionary vs. Submission 

### WBS Elements Without Units, Dollars, and Hours

The following is a table of lowest level WBS elements that have no reported costs, hours, and units.

```{r wbs_with_no_cost_hours_units}
wbs_with_no_cost_hours_units <- csdr %>% 
  filter(is_lowest == "TRUE",
         !is.na(FunctionalCategory)) %>%
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              WBSDictionaryDefinitions,
                              WBSElementRemarks),
              names_from  = c(UnitOfMeasure,
                              ToDate_AtCompletion,
                              Recurring_Nonrecurring),
              values_from = Value,
              values_fn   = list(Value = sum),
              values_fill = list(Value = 0)) %>% 
  filter_if(.vars_predicate = all_vars(. == 0), .predicate = is.numeric) %>% 
  select(WBSElementID, WBSElementName, WBSDictionaryDefinitions, WBSElementRemarks)

wbs_with_no_cost_hours_units %>% 
  gt::gt() %>% 
  gt::tab_header(title = "WBS Dictionary Entries", 
                 subtitle = "Lowest Level WBS With \"0\" Reported Units, Dollars, and Hours") %>% 
  gt::tab_options(table.font.size = "8",data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"))
```

>**QUESTIONS FOR REVIEWER:** For a WBS Element to have no reported units, costs, and hours would require that WBS Element have no associated scope of work awarded on the contract.  Even if a WBS Element has no associated scope of work awarded on the contract, the WBS Dictionary entry must say so or say "NA".  
1. Based on your knowledge of the program, is it reasonable for the identified WBS Elements listed above to have no reported units, dollars, and hours?  
2. Does the dictionary entry for each WBS say either "NA" or that no scope of work is on contract for each element?  
3. Are their any dictionary entries that provide a technical description or otherwise indicate/imply that the WBS Element should have included some units, costs, and/or hours?  

### WBS Elements With Units, Dollars, or Hours

The following is a table of lowest level WBS elements that have at least reported costs, hours, or units.

```{r wbs_with_cost_hours_units}
wbs_with_cost_hours_units <- csdr %>% 
  filter(is_lowest == "TRUE",
         !is.na(FunctionalCategory)) %>%
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              WBSDictionaryDefinitions,
                              WBSElementRemarks),
              names_from  = c(UnitOfMeasure,
                              ToDate_AtCompletion,
                              Recurring_Nonrecurring),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(WBSElementID, WBSElementName, WBSDictionaryDefinitions, WBSElementRemarks)

wbs_with_cost_hours_units %>% 
  gt::gt() %>% 
  gt::tab_header(title = "WBS Dictionary Entries", 
                 subtitle = "Lowest Level WBS With Greater Than \"0\" Reported Units, Dollars, and Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"))
```

>**QUESTIONS FOR REVIEWER:** The flip side of "dictionary entries with no units, hours, dollars" is a dictionary entry that has units, hours, or dollars but says that it should not.  
1. Are any of the above WBS dictionary "NA" or indicate that scope of work is not awarded or that a WBS element is not applicable to the design?   

## Quantity Review

### Quantity by WBS Element

```{r units_by_wbs}
# All WBS Elements
units_by_wbs <- csdr %>% 
  filter(UnitOfMeasure == "Units") %>% 
  pivot_wider(id_cols     = c(WBSElementID, WBSElementName),
              names_from  = c(Recurring_Nonrecurring, ToDate_AtCompletion),
              values_from = Value)

units_by_wbs %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Units by WBS", 
                 subtitle = NULL) %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(3:ncol(units_by_wbs)), drop_trailing_zeros = TRUE)
```

### Quantity by WBS Element (Only If > 0)

```{r units_by_wbs_nonzero}
# Only WBS Element With a Units > 0
units_by_wbs_nonzero <- csdr %>% 
  filter(UnitOfMeasure == "Units") %>% 
  pivot_wider(id_cols     = c(WBSElementID, WBSElementName),
              names_from  = c(Recurring_Nonrecurring, ToDate_AtCompletion),
              values_from = Value) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric)

units_by_wbs_nonzero %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Units by WBS", 
                 subtitle = "Includes Only WBS with Greater Than 0 Units") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(3:ncol(units_by_wbs_nonzero)), drop_trailing_zeros = TRUE)
```

>**QUESTIONS FOR REVIEWER:** The reported "As Of Date" for this CSDR Submission is __`r ff$MetaData$"16 Report As Of"`__ and the reported latest contract modification is __`r ff$MetaData$"10b Latest Modification"`__.  
Given those programmatic considerations...  
1. Are the reported `Units To Date` reasonable considering the contract's delivery and/or production schedule?  
2. Are the reported `Units At Completion` equal to what was on contract on the as of date?  


## Unit Review

### Dollars

#### Nonrecurring

#### Recurring

### Hours

#### Nonrecurring

#### Recurring

## Percent Complete

### Dollars

#### Total

The following table identifies the number of Hours To Date and At Completion for only the lowest level WBS elements.

```{r PctComplete_Dollars}
PctComplete_Dollars <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Dollars %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Dollars To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Dollars) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Dollars %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Dollars To Date vs. At Completion, Sorted by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Dollars) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Nonrecurring

The following table identifies the number of Nonrecurring Hours To Date and At Completion for only the lowest level WBS elements.

```{r PctComplete_Dollars_Nonrecurring}
PctComplete_Dollars_Nonrecurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Dollars_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Dollars To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Dollars_Nonrecurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Dollars_Nonrecurring %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Nonrecurring Dollars To Date vs. At Completion, Sorted by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Dollars_Nonrecurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Recurring

The following table identifies the number of Recurring Hours To Date and At Completion for only the lowest level WBS elements.

```{r PctComplete_Dollars_Recurring}
PctComplete_Dollars_Recurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Dollars_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Dollars To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Dollars_Recurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Dollars_Recurring %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Recurring Dollars To Date vs. At Completion, Sorted by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Dollars_Recurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

### Hours

#### Total

The following table identifies the number of Hours To Date and At Completion for only the lowest level WBS elements.

```{r PctComplete_Hours}
PctComplete_Hours <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Hours %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Hours To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Hours) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Hours %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Hours To Date vs. At Completion, Arranged by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Hours) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Nonrecurring

The following table identifies the number of Nonrecurring Hours To Date and At Completion for only the lowest level WBS elements.

```{r PctComplete_Hours_Nonrecurring}
PctComplete_Hours_Nonrecurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Hours_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Hours To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Hours_Nonrecurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Hours_Nonrecurring %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Nonrecurring Hours To Date vs. At Completion, Arranged by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Hours_Nonrecurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Recurring

The following table identifies the number of Recurring Hours To Date and At Completion for only the lowest level WBS elements.  

```{r PctComplete_Hours_Recurring}
PctComplete_Hours_Recurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(PctComplete = ToDate / AtCompletion,
         PctError    = ifelse(PctComplete > 1, "CRITICAL ERROR", "-")) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  group_by(WBSElementID, WBSElementName)

PctComplete_Hours_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Recurring Hours To Date vs. At Completion, Arranged by WBS", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(5:(ncol(PctComplete_Hours_Recurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)

PctComplete_Hours_Recurring %>% 
  select(-FunctionalCategory) %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Recurring Hours To Date vs. At Completion, Sorted by FunctionalElement", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_number(columns = c(4:(ncol(PctComplete_Hours_Recurring) - 2)), drop_trailing_zeros = TRUE) %>% 
  gt::fmt_percent(columns = vars(PctComplete), decimals = 1, drop_trailing_zeros = TRUE)
```

### Hours vs. Dollars

#### Total

The following table compares "HoursPctCompete" against "DollarsPctComplete" and is arranged in order of highest to smallest delta between those values. 

```{r PctComplete_HvD}
PctComplete_HvD <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(HoursPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion) %>% 
  
  left_join(., {

csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(DollarsPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion)
},
by = c("WBSElementID", "WBSElementName", "FunctionalCategory", "FunctionalElement")) %>% 
  mutate(Delta = HoursPctComplete - DollarsPctComplete) %>% 
  filter(Delta != 0) %>% 
  arrange(desc(abs(Delta)))

PctComplete_HvD  %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Hours Complete vs. Dollars Complete, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = vars(HoursPctComplete, DollarsPctComplete, Delta), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Nonrecurring

The following table compares Nonrecurring "HoursPctCompete" against Nonrecurring "DollarsPctComplete" and is arranged in order of highest to smallest delta between those values. 

```{r PctComplete_HvD_Nonrecurring}
PctComplete_HvD_Nonrecurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(HoursPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion) %>% 
  
  left_join(., {

csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(DollarsPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion)
},
by = c("WBSElementID", "WBSElementName", "FunctionalCategory", "FunctionalElement")) %>% 
  mutate(Delta = HoursPctComplete - DollarsPctComplete) %>% 
  filter(Delta != 0) %>% 
  arrange(desc(abs(Delta)))

PctComplete_HvD_Nonrecurring  %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Hours Complete vs. Dollars Complete, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = vars(HoursPctComplete, DollarsPctComplete, Delta), decimals = 1, drop_trailing_zeros = TRUE)
```

#### Recurring

The following table compares Recurring "HoursPctCompete" against Recurring "DollarsPctComplete" and is arranged in order of highest to smallest delta between those values. 

```{r PctComplete_HvD_Recurring}
PctComplete_HvD_Recurring <- csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Hours",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(HoursPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion) %>% 
  
  left_join(., {

csdr %>% 
  filter(is_lowest              == "TRUE",
         UnitOfMeasure          == "Dollars",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalElement)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName,
                              FunctionalCategory,
                              FunctionalElement),
              names_from  = c(ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  mutate(DollarsPctComplete = ToDate / AtCompletion) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  select(-ToDate, -AtCompletion)
},
by = c("WBSElementID", "WBSElementName", "FunctionalCategory", "FunctionalElement")) %>% 
  mutate(Delta = HoursPctComplete - DollarsPctComplete) %>% 
  filter(Delta != 0) %>% 
  arrange(desc(abs(Delta)))

PctComplete_HvD_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Recurring Hours Complete vs. Dollars Complete, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = vars(HoursPctComplete, DollarsPctComplete, Delta), decimals = 1, drop_trailing_zeros = TRUE)
```

>**QUESTIONS FOR REVIEWER:** The reported "As Of Date" for this CSDR Submission is __`r ff$MetaData$"16 Report As Of"`__ and the reported latest contract modification is __`r ff$MetaData$"10b Latest Modification"`__.  
Given those programmatic considerations...  
1. Are there any `PctErrors` (i.e., a WBS with greater than 100% complete)?   
2. Are the observed percent complete (`PctComplete`) values reasonable?  
3. Are there any WBS elements which have a large `Delta` between `HoursPctComplete` and `DollarsPctComplete` (there is no rule of for how much of a `Delta` is too much but more than a +/- 10% difference is likely worth consideration).

## Average Labor Rates

### By Functional Element

#### To Date

##### Total

The following table identifies the average labor rate To Date by FunctionalElement for lowest level WBS elements.

```{r laborRate_ToDate}
laborRate_ToDate <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "ToDate",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_ToDate %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Labor Rate To Date by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_ToDate)))
```

##### Nonrecurring

The following table identifies the average nonrecurring labor rate To Date by FunctionalElement for lowest level WBS elements.

```{r laborRate_ToDate_Nonrecurring}
laborRate_ToDate_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "ToDate",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_ToDate_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Labor Rate To Date by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_ToDate_Nonrecurring)))
```

##### Recurring

The following table identifies the average recurring labor rate To Date by FunctionalElement for lowest level WBS elements.

```{r laborRate_ToDate_Recurring}
laborRate_ToDate_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "ToDate",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_ToDate_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Labor Rate To Date by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_ToDate_Recurring)))
```

#### At Completion

##### Total

The following table identifies the average nonrecurring labor rate AtCompletion by FunctionalElement for lowest level WBS elements.

```{r laborRate_AtCompletion}
laborRate_AtCompletion <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "AtCompletion",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_AtCompletion %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Labor Rate At Completion by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_AtCompletion)))
```

##### Nonrecurring

The following table identifies the average nonrecurring labor rate AtCompletion by FunctionalElement for lowest level WBS elements.

```{r laborRate_AtCompletion_Nonrecurring}
laborRate_AtCompletion_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "AtCompletion",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_AtCompletion_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Labor Rate At Completion by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_AtCompletion_Nonrecurring)))
```

##### Recurring

The following table identifies the average recurring labor rate At Completion by Functional Element for lowest level WBS elements.

```{r laborRate_AtCompletion_Recurring}
laborRate_AtCompletion_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "AtCompletion",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Direct Engineering`     = sum(`Direct Engineering Labor_Dollars` / `Direct Engineering Labor_Hours`, na.rm = TRUE),
         `Direct Tooling`         = sum(`Direct Tooling Labor_Dollars` / `Direct Tooling Labor_Hours`, na.rm = TRUE),
         `Direct Quality Control` = sum(`Direct Quality Control Labor_Dollars` / `Direct Quality Control Labor_Hours`, na.rm = TRUE),
         `Direct Manufacturing`   = sum(`Direct Manufacturing Labor_Dollars` / `Direct Manufacturing Labor_Hours`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Direct Engineering`,
         `Direct Tooling`,
         `Direct Quality Control`,
         `Direct Manufacturing`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

laborRate_AtCompletion_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Labor Rate At Completion by Functional Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_AtCompletion_Recurring)))
```

### Direct Engineering Labor Rate To Date vs. At Completion

#### Total

The following table identifies the average Direct Engineering labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Eng}
laborRate_Eng <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Engineering Labor_Dollars_ToDate` / `Direct Engineering Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Engineering Labor_Dollars_AtCompletion` / `Direct Engineering Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Eng %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Direct Engineering Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Eng)))
```

#### Nonrecurring

The following table identifies the average Nonrecurring Direct Engineering labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Eng_Nonrecurring}
laborRate_Eng_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Engineering Labor_Dollars_ToDate` / `Direct Engineering Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Engineering Labor_Dollars_AtCompletion` / `Direct Engineering Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Eng_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Direct Engineering Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Eng_Nonrecurring)))
```

#### Recurring

The following table identifies the average Recurring Direct Engineering labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Eng_Recurring}
laborRate_Eng_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Engineering Labor_Dollars_ToDate` / `Direct Engineering Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Engineering Labor_Dollars_AtCompletion` / `Direct Engineering Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Eng_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Direct Engineering Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Eng_Recurring)))
```

### Direct Tooling Labor Rate To Date vs. At Completion

#### Total

The following table identifies the average Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Tool}
laborRate_Tool <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Tooling Labor_Dollars_ToDate` / `Direct Tooling Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Tooling Labor_Dollars_AtCompletion` / `Direct Tooling Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Tool %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Direct Tooling Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Tool)))
```

#### Nonrecurring

The following table identifies the average Nonrecurring Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Tool_Nonrecurring}
laborRate_Tool_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Tooling Labor_Dollars_ToDate` / `Direct Tooling Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Tooling Labor_Dollars_AtCompletion` / `Direct Tooling Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Tool_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Direct Tooling Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Tool_Nonrecurring)))
```

#### Recurring

The following table identifies the average Recurring Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Tool_Recurring}
laborRate_Tool_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Tooling Labor_Dollars_ToDate` / `Direct Tooling Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Tooling Labor_Dollars_AtCompletion` / `Direct Tooling Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Tool_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Direct Tooling Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Tool_Recurring)))
```

### Direct Quality Control Labor Rate To Date vs. At Completion

#### Total

The following table identifies the average Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Quality}
laborRate_Quality <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Quality Control Labor_Dollars_ToDate` / `Direct Quality Control Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Quality Control Labor_Dollars_AtCompletion` / `Direct Quality Control Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Quality %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Direct Quality Control Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Quality)))
```

#### Nonrecurring

The following table identifies the average Nonrecurring Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Quality_Nonrecurring}
laborRate_Quality_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Quality Control Labor_Dollars_ToDate` / `Direct Quality Control Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Quality Control Labor_Dollars_AtCompletion` / `Direct Quality Control Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Quality_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Direct Quality Control Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Quality_Nonrecurring)))
```

#### Recurring

The following table identifies the average Recurring Direct Quality Control labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Quality_Recurring}
laborRate_Quality_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Quality Control Labor_Dollars_ToDate` / `Direct Quality Control Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Quality Control Labor_Dollars_AtCompletion` / `Direct Quality Control Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Quality_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Direct Quality Control Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Quality_Recurring)))
```

### Manufacturing Labor Rate To Date vs. At Completion

#### Total

The following table identifies the average Direct Manufacturing labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Manf}
laborRate_Manf <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Manufacturing Labor_Dollars_ToDate` / `Direct Manufacturing Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Manufacturing Labor_Dollars_AtCompletion` / `Direct Manufacturing Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Manf %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Direct Manufacturing Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Manf)))
```

#### Nonrecurring

The following table identifies the average Nonrecurring Direct Manufacturing labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Manf_Nonrecurring}
laborRate_Manf_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Manufacturing Labor_Dollars_ToDate` / `Direct Manufacturing Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Manufacturing Labor_Dollars_AtCompletion` / `Direct Manufacturing Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Manf_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Nonrecurring Direct Manufacturing Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Manf_Nonrecurring)))
```

#### Recurring

The following table identifies the average Recurring Direct Manufacturing labor rate To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r laborRate_Manf_Recurring}
laborRate_Manf_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Direct Manufacturing Labor_Dollars_ToDate` / `Direct Manufacturing Labor_Hours_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Direct Manufacturing Labor_Dollars_AtCompletion` / `Direct Manufacturing Labor_Hours_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

laborRate_Manf_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Average Recurring Direct Manufacturing Labor Rate To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Hours and Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_currency(columns = c(3:ncol(laborRate_Manf_Recurring)))
```

## Overhead Factors

### Overhead Factor by Functional Element

#### To Date

##### Total

The following table identifies the average overhead factor To Date by FunctionalElement for lowest level WBS elements.

```{r ovhFct_ToDate}
ovhFct_ToDate <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "ToDate",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_ToDate %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Overhead Factor To Date by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_ToDate)), decimals = 1)
```

##### Nonrecurring

The following table identifies the average Nonrecurring overhead factor To Date by FunctionalElement for lowest level WBS elements.

```{r ovhFct_ToDate_Nonrecurring}
ovhFct_ToDate_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         ToDate_AtCompletion == "ToDate",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_ToDate_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Overhead Factors To Date by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_ToDate_Nonrecurring)), decimals = 1)
```

##### Recurring

The following table identifies the average Recurring overhead factor To Date by FunctionalElement for lowest level WBS elements.

```{r ovhFct_ToDate_Recurring}
ovhFct_ToDate_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         ToDate_AtCompletion == "ToDate",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_ToDate_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Recurring Overhead Factors To Date by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_ToDate_Recurring)), decimals = 1)
```

#### At Completion

##### Total

The following table identifies the average overhead factor At Completion by FunctionalElement for lowest level WBS elements.

```{r ovhFct_AtCompletion}
ovhFct_AtCompletion <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         ToDate_AtCompletion == "AtCompletion",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_AtCompletion %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Overhead Factors At Completion by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_AtCompletion)), decimals = 1)
```

##### Nonrecurring

The following table identifies the average Nonrecurring overhead factor At Completion by FunctionalElement for lowest level WBS elements.

```{r ovhFct_AtCompletion_Nonrecurring}
ovhFct_AtCompletion_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         ToDate_AtCompletion == "AtCompletion",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_AtCompletion_Nonrecurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Nonrecurring Overhead Factors At Completion by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_AtCompletion_Nonrecurring)), decimals = 1)
```

##### Recurring

The following table identifies the average Recurring overhead factor At Completion by FunctionalElement for lowest level WBS elements.

```{r ovhFct_AtCompletion_Recurring}
ovhFct_AtCompletion_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         ToDate_AtCompletion == "AtCompletion",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`Engineering Overhead Factor` = 
           sum(`Engineering Overhead_Dollars` / `Direct Engineering Labor_Dollars`, 
               na.rm = TRUE),
         `Manufacturing Operations Overhead Factor` = 
           sum(`Manufacturing Operations Overhead_Dollars` / `Direct Manufacturing Labor_Dollars`,
               na.rm = TRUE),
         `Material Handling/Overhead Factor` = 
           sum((`Raw Material_Dollars`
                + `Purchased Parts_Dollars`
                + `Purchased Equipment_Dollars`) 
                / `Material Handling/Overhead_Dollars`,
               na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `Engineering Overhead Factor`,
         `Manufacturing Operations Overhead Factor`,
         `Material Handling/Overhead Factor`) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>% 
  ungroup()

ovhFct_AtCompletion_Recurring %>% 
  gt::gt() %>% 
  gt::tab_header(title = "Recurring Overhead Factors At Completion by WBS Element", 
                 subtitle = "Includes Only Lowest Level WBS with Reported Dollars") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_AtCompletion_Recurring)), decimals = 1)
```

#### Engineering Overhead Rate To Date vs. At Completion

##### Total

The following table identifies the average Direct Engineering Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Eng}
ovhFct_Eng <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Engineering Overhead_Dollars_ToDate` / `Direct Engineering Labor_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Engineering Overhead_Dollars_AtCompletion` / `Direct Engineering Labor_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Eng %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Engineering Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Eng)), decimals = 1)
```

##### Nonrecurring

The following table identifies the average Nonrecurring Direct Engineering Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Eng_Nonrecurring}
ovhFct_Eng_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Engineering Overhead_Dollars_ToDate` / `Direct Engineering Labor_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Engineering Overhead_Dollars_AtCompletion` / `Direct Engineering Labor_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Eng_Nonrecurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Nonrecurring Direct Engineering Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Eng_Nonrecurring)), decimals = 1)
```

##### Recurring

The following table identifies the average Recurring Direct Engineering Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Eng_Recurring}
ovhFct_Eng_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Engineering Overhead_Dollars_ToDate` / `Direct Engineering Labor_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Engineering Overhead_Dollars_AtCompletion` / `Direct Engineering Labor_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Eng_Recurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Recurring Direct Engineering Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Eng_Recurring)), decimals = 1)
```

#### Manufacturing Operations Overhead Factor To Date vs. At Completion

##### Total

The following table identifies the average Manufacturing Operations Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Manf}
ovhFct_Manf <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Manufacturing Operations Overhead_Dollars_ToDate` / `Manufacturing Operations Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Manufacturing Operations Overhead_Dollars_AtCompletion` / `Manufacturing Operations Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Manf %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Manufacturing Operations Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Manf)), decimals = 1)
```

##### Nonrecurring

The following table identifies the average Nonrecurring Manufacturing Operations Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Manf_Nonrecurring}
ovhFct_Manf_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Manufacturing Operations Overhead_Dollars_ToDate` / `Manufacturing Operations Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Manufacturing Operations Overhead_Dollars_AtCompletion` / `Manufacturing Operations Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Manf_Nonrecurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Nonrecurring Manufacturing Operations Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Manf_Nonrecurring)), decimals = 1)
```

##### Recurring

The following table identifies the average Recurring Manufacturing Operations Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Manf_Recurring}
ovhFct_Manf_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Manufacturing Operations Overhead_Dollars_ToDate` / `Manufacturing Operations Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Manufacturing Operations Overhead_Dollars_AtCompletion` / `Manufacturing Operations Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Manf_Recurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Recurring Manufacturing Operations Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Manf_Recurring)), decimals = 1)
```

#### Material Handling/Overhead Factor To Date vs. At Completion

##### Total

The following table identifies the average Material Handling/Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Mat}
ovhFct_Mat <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Material Handling/Overhead_Dollars_ToDate` / `Material Handling/Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Material Handling/Overhead_Dollars_AtCompletion` / `Material Handling/Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Mat %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Material Handling/Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Mat)), decimals = 1)
```

##### Nonrecurring

The following table identifies the average Nonrecurring Material Handling/Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Mat_Nonrecurring}
ovhFct_Mat_Nonrecurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Nonrecurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Material Handling/Overhead_Dollars_ToDate` / `Material Handling/Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Material Handling/Overhead_Dollars_AtCompletion` / `Material Handling/Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Mat_Nonrecurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Nonrecurring Material Handling/Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Mat_Nonrecurring)), decimals = 1)
```

##### Recurring

The following table identifies the average Recurring Material Handling/Overhead Factor To Date vs. At Completion and the difference (Delta) between those two values, for lowest level WBS elements, arranged in descending Delta order.

```{r ovhFct_Mat_Recurring}
ovhFct_Mat_Recurring <- csdr %>% 
  filter(is_lowest == "TRUE",
         UnitOfMeasure != "Units",
         Recurring_Nonrecurring == "Recurring",
         !is.na(FunctionalCategory)) %>% 
  pivot_wider(id_cols     = c(WBSElementID,
                              WBSElementName),
              names_from  = c(FunctionalElement, UnitOfMeasure, ToDate_AtCompletion),
              values_from = Value,
              values_fn   = list(Value = sum)) %>% 
  group_by(WBSElementID,
           WBSElementName) %>% 
  mutate(`To Date`       = sum(`Material Handling/Overhead_Dollars_ToDate` / `Material Handling/Overhead_Dollars_ToDate`, na.rm = TRUE),
         `At Completion` = sum(`Material Handling/Overhead_Dollars_AtCompletion` / `Material Handling/Overhead_Dollars_AtCompletion`, na.rm = TRUE),
         Delta           = sum(`To Date` - `At Completion`, na.rm = TRUE)) %>% 
  select(WBSElementID,
         WBSElementName,
         `To Date`,
         `At Completion`,
         Delta) %>% 
  filter_if(.vars_predicate = any_vars(. > 0), .predicate = is.numeric) %>%
  arrange(desc(Delta)) %>% 
  ungroup()

ovhFct_Mat_Recurring %>% 
  gt::gt(groupname_col = "FunctionalElement") %>% 
  gt::tab_header(title = "Recurring Material Handling/Overhead Factor To Date vs. At Completion, Arranged by Decending Delta", 
                 subtitle = "Includes Only Lowest Level WBS with Greater Than 0 Hours") %>% 
  gt::tab_options(table.font.size = "8", data_row.padding = gt::px(1)) %>% gt::cols_align(c("left"), columns = c("WBSElementID",	"WBSElementName")) %>%
  gt::fmt_percent(columns = c(3:ncol(ovhFct_Mat_Recurring)), decimals = 1)
```

-------------------------------------------------------------------------------
Each WBS Dictionary entry (except those with no expected work^[Via DI-MGMT-81334D: "If work is not expected to occur for a given WBS element, the CWBS dictionary definition must indicate that this element is not applicable"].) must include the following (quotes via DI-MGMT-81334D):  

1. *Technical Description*: "[System level WBS] must include a general system level description (i.e., highest level WBS element) of the military end item that captures top-level attributes of the system... provide general descriptions of the physical characteristics of each individual element below the system level.... Each WBS element definition must provide the [reader] with the means to determine what the item is, what it does within the system, and how the item is physically defined.... [I]nclude a short description of the process used to design, produce or sustain the end item or service."  
2. *Description of Recurring and Nonrecurring*: "Cost content definitions must include explanations of recurring versus nonrecurring efforts...".  
3. *Description by Functional Element*: "Cost content definitions must include... characterizations by functional category (i.e., engineering, tooling, quality control, and manufacturing) as appropriate [(i.e., provide a description for engineering, tooling, quality control, or manufacturing if the reported costs/hours for that functional category is greater than 0)]".  
4. *Description of Type of Activity*: "The description must address the types of activities (e.g., design, production, analysis, or management) included within the WBS element."  
5. *Completed by Prime Subcontractor / Make vs. Buy*: "Cost content definitions must include... purchased versus made in-house decisions.... These descriptions must include information on whether the reporting contractor or a supplier/subcontractor is performing the work being described."  
6. *Description of GFE*: "All GFE items being integrated into the system as part of the contract must be labeled as such in the CWBS dictionary under the appropriate elements."  

-------------------------------------------------------------------------------

# How-To's

-------------------------------------------------------------------------------
## Downloading an XML Version of a CSDR Plan{#download_xml_csdr_plan}

How do find and download an XML copy of a CSDR Plan.  

1. Log into the secure "[CADE Portal](https://service.cade.osd.mil/cadeportal)".
1. Select "[CSDR-SR](https://service.cade.osd.mil/csdrsr/)" from the "Applications" menu.
1. Hover over "My CSDR" and then click "[Program Planning](https://service.cade.osd.mil/csdrsr/site/ProgramPlanning/ProgramPlanningModuleSearch.aspx)".
1. Find the program of interest and click on its name.
1. Click "Approved Documentation".
1. Click on the applicable "Plan Number".
1. Scroll down to the "Documents" section and find the row/area for the CSDR Plan(s) (normally this is the first section under "Documents").
1. Find and click the icon that looks like a piece of paper with three lines (if you hover over it, you can confirm its name and that it ends in ".XML").
1. Save the file to the location of your choosing.

-------------------------------------------------------------------------------
## Creating the CSDR Submission Flat File

The following workflow utilizes the CSDR Flat File submission format.  If you already have a Flat File format submission, [you can skip a few steps](#read_flat_file).  If the submission was not in the Flat File format, it can be created utilizing [cPet desktop](https://cade.osd.mil/tools/csdr-tools) and the following files:  

1. An XML copy of the CSDR Plan^[For instructions on how to find and download an XML copy of a CSDR Plan, [click here](#download_xml_csdr_plan).]
1. An Excel copy of the CSDR DD Form 1921 submission.  
1. An Excel copy of the CSDR DD Form 1921-1 submission.  

Utilize the following directions to convert the Plan, 1921, and 1921-1 into the Flat File format:  
 
```{r}
# TODO: Update this to provide better direction on what to do if there is a critical error.  Maybe include a screenshot of what that looks like.  Tell the user to 100% stop the review and send back to the submitter for correction before moving forward.
```
 
1. Drag and drop the the XML CSDR Plan into cPet desktop.
1. Right-click on the CSDR Plan icon, and select "Import DD 1921..." and point the selection box to the DD Form 1921 Excel submission.^[If there are critical errors identified during this step, the submitter may have to fix them and resubmit before you can continue.]
1. After the DD Form 1921 has been imported to cPet, right-click the new DD Form 1921 icon and select "Import DD 1921-1..." and point the selection box to the DD Form 1921 Excel submission.^[If there are critical errors identified during this step, the submitter may have to fix them and resubmit before you can continue.]
1. After the DD Form 1921-1 has been imported to cPet, right-click the new DD Form 1921-1 icon and select "Export Flat File (1921 & 1921-1)..." and save the file. 
1. cPet will export the file as a legacy (".xls") Excel file.  We need to convert the Flat File to Excel's new ".xlsx" file format to work with the rest of this code.  Open the cPet created file in Excel, click "File", "Save As", select the save location, click the "Save as type:" drop-down and select "Excel Workbook (*.xlsx)", click "Save".  
